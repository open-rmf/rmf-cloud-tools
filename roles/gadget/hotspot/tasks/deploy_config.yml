---
- name: hostapd.conf
  template:
    src: hostapd.conf.j2
    dest: /etc/hostapd/hostapd.conf
    backup: true
    mode: 0644
  become: yes

- name: restart hostapd
  service:
    name: hostapd
    masked: no
    state: restarted 
  become: yes

- name: wireless.network 
  template:
    src: 25-wireless.network.j2
    dest: /etc/systemd/network/25-wireless.network
    backup: true
    mode: 0644
  become: yes

- name: wired.network 
  template:
    src: 20-wired.network.j2
    dest: /etc/systemd/network/20-wired.network
    backup: true
    mode: 0644
  become: yes

- name: dnsmasq.conf
  template:
    src: dnsmasq.conf.j2
    dest: /etc/dnsmasq.conf
    backup: true
    mode: 0644
  become: yes

- name: Disable DNS on resolved
  lineinfile:
    path: /etc/systemd/resolved.conf
    regexp: '^#DNSStubListener=no'
    line: 'DNSStubListener=no'
  become: yes

- name: restart dnsmasq
  service:
    name: dnsmasq
    masked: no
    state: restarted
  become: yes

- name: restart networking
  service:
    name: systemd-networkd 
    masked: no
    state: restarted
  become: yes

- name: rc.local
  template:
    src: rc.local.j2
    dest: /etc/rc.local
    backup: true
  become: yes

- name: restart rclocal
  shell: "sh /etc/rc.local"
  become: yes

- name: disable wait online service
  service:
    name: systemd-networkd-wait-online 
    masked: yes
    state: stopped 
  become: yes

